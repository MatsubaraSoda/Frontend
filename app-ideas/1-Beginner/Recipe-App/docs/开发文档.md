# 开发文档

## 一般说明

- 网站的所有内容使用英文。尽管开发过程中的文档使用中文。这是因为菜谱 API 提供是 The MealDB API，它们提供的是英文内容。

## index.html

用户打开应用后，首先看见的是主页页面。

页面左上角显示网站标题：“Recipe-APP”。

在页面的中间位置提供一个搜索框，提示内容为：“请输入您想要的菜谱”。（请你翻译成适合的英文）。
```
----------------------------------
|请输入您想要的菜谱~   | （搜索符号） |
----------------------------------
```

在搜索框的周围，有许多的气泡，内容是菜谱的名字，用户点击后则进入菜谱页面。recipe.html。气泡的内容将通过 `www.themealdb.com/api/json/v1/1/random.php` API 来实现。实际实现生成 8 个气泡。

用户输入菜谱名字并确认后，将会通过 The MealDB API 查询菜谱。返回 json 格式的内容，里面包含菜谱的信息。由于可能不止一个菜谱，在 await 返回值的过程中，弹出一个全屏模态框，封锁用户的操作。全屏模态框做两件事情。一是在没有获得返回值的时候，提供一个加载的动态效果，以及“正在努力搜索菜谱”的英文提示。二是，但收到返回值的时候，在这个全屏模态框渲染出一个表格，内容是所有的菜谱的名字`strMeal`。当用户点击相应的菜谱名后，跳转到 recipe.html。并根据相应的 json 数据生成内容。

API 的示例（改应用只实现 Search meal by name）：

```
https://www.themealdb.com/api/json/v1/1/search.php?s=Spicy
```

```
{
  "meals": [
    {
      "idMeal": "52771",
      "strMeal": "Spicy Arrabiata Penne",
      "strMealAlternate": null,
      "strCategory": "Vegetarian",
      "strArea": "Italian",
      "strInstructions": "Bring a large pot of water to a boil. Add kosher salt to the boiling water, then add the pasta. Cook according to the package instructions, about 9 minutes.\r\nIn a large skillet over medium-high heat, add the olive oil and heat until the oil starts to shimmer. Add the garlic and cook, stirring, until fragrant, 1 to 2 minutes. Add the chopped tomatoes, red chile flakes, Italian seasoning and salt and pepper to taste. Bring to a boil and cook for 5 minutes. Remove from the heat and add the chopped basil.\r\nDrain the pasta and add it to the sauce. Garnish with Parmigiano-Reggiano flakes and more basil and serve warm.",
      "strMealThumb": "https://www.themealdb.com/images/media/meals/ustsqw1468250014.jpg",
      "strTags": "Pasta,Curry",
      "strYoutube": "https://www.youtube.com/watch?v=1IszT_guI08",
      "strIngredient1": "penne rigate",
      "strIngredient2": "olive oil",
      "strIngredient3": "garlic",
      "strIngredient4": "chopped tomatoes",
      "strIngredient5": "red chilli flakes",
      "strIngredient6": "italian seasoning",
      "strIngredient7": "basil",
      "strIngredient8": "Parmigiano-Reggiano",
      "strIngredient9": "",
      "strIngredient10": "",
      "strIngredient11": "",
      "strIngredient12": "",
      "strIngredient13": "",
      "strIngredient14": "",
      "strIngredient15": "",
      "strIngredient16": null,
      "strIngredient17": null,
      "strIngredient18": null,
      "strIngredient19": null,
      "strIngredient20": null,
      "strMeasure1": "1 pound",
      "strMeasure2": "1/4 cup",
      "strMeasure3": "3 cloves",
      "strMeasure4": "1 tin ",
      "strMeasure5": "1/2 teaspoon",
      "strMeasure6": "1/2 teaspoon",
      "strMeasure7": "6 leaves",
      "strMeasure8": "sprinkling",
      "strMeasure9": "",
      "strMeasure10": "",
      "strMeasure11": "",
      "strMeasure12": "",
      "strMeasure13": "",
      "strMeasure14": "",
      "strMeasure15": "",
      "strMeasure16": null,
      "strMeasure17": null,
      "strMeasure18": null,
      "strMeasure19": null,
      "strMeasure20": null,
      "strSource": null,
      "strImageSource": null,
      "strCreativeCommonsConfirmed": null,
      "dateModified": null
    },
    {
      "idMeal": "52797",
      "strMeal": "Spicy North African Potato Salad",
      "strMealAlternate": null,
      "strCategory": "Vegetarian",
      "strArea": "Moroccan",
      "strInstructions": "Cook potatoes - place potatoes in a pot of cold water, and bring to the boil. Boil 20 minutes, or until potatoes are tender. You know they are cooked when you can stick a knife in them and the knife goes straight through.\r\nCombine harissa spice, olive oil, salt and pepper and lemon juice in a small bowl and whisk until combined.\r\nOnce potatoes are cooked, drain water and roughly chop potatoes in half.\r\nAdd harissa mix and spring onions/green onions to potatoes and stir.\r\nIn a large salad bowl, lay out arugula/rocket.\r\nTop with potato mix and toss.\r\nAdd fetta, mint and sprinkle over pine nuts.\r\nAdjust salt and pepper to taste.",
      "strMealThumb": "https://www.themealdb.com/images/media/meals/urtwux1486983078.jpg",
      "strTags": "Vegetarian,Spicy",
      "strYoutube": "https://www.youtube.com/watch?v=zxBzwJvTK4g",
      "strIngredient1": "Small Potatoes",
      "strIngredient2": "Harissa Spice",
      "strIngredient3": "olive oil",
      "strIngredient4": "Lemon",
      "strIngredient5": "Spring onions",
      "strIngredient6": "Rocket",
      "strIngredient7": "Feta",
      "strIngredient8": "Mint",
      "strIngredient9": "Pine nuts",
      "strIngredient10": "Salt",
      "strIngredient11": "Pepper",
      "strIngredient12": "",
      "strIngredient13": "",
      "strIngredient14": "",
      "strIngredient15": "",
      "strIngredient16": "",
      "strIngredient17": "",
      "strIngredient18": "",
      "strIngredient19": "",
      "strIngredient20": "",
      "strMeasure1": "650g/1lb 8 oz",
      "strMeasure2": "1 tsp",
      "strMeasure3": "2 tsp",
      "strMeasure4": "juice of half",
      "strMeasure5": "4",
      "strMeasure6": "150g/6oz",
      "strMeasure7": "80g/3oz",
      "strMeasure8": "20 chopped",
      "strMeasure9": "2 tablespoons",
      "strMeasure10": "Pinch",
      "strMeasure11": "Pinch",
      "strMeasure12": "",
      "strMeasure13": "",
      "strMeasure14": "",
      "strMeasure15": "",
      "strMeasure16": "",
      "strMeasure17": "",
      "strMeasure18": "",
      "strMeasure19": "",
      "strMeasure20": "",
      "strSource": "",
      "strImageSource": null,
      "strCreativeCommonsConfirmed": null,
      "dateModified": null
    }
  ]
}
```

这个模态框将要实现三种提示：加载中（搜索菜谱中）、请选择（返回可能不止一种菜谱）、没有找到（比如用户输入的是中文，那将返回为空）。一共三种状态。
空返回为：

```
https://www.themealdb.com/api/json/v1/1/search.php?s=你好
```

```
{
  "meals": null
}
```

- [x] 主页标题
- [x] 菜谱搜索框
- [x] 菜谱气泡
- [x] 模态框

## recipe.html

recipe.html 是食谱详情页面，用于展示从 index.html 传递过来的食谱详细信息。页面将展示单个食谱的完整内容，包括图片、基本信息、配料清单和制作步骤。

### 页面布局设计

页面采用响应式布局，分为以下几个主要区域：

```
+----------------------------------+
|          导航栏                   |
|  [< Back to Search] Recipe-APP    |
+----------------------------------+
|                                  |
|        食谱主图区域                |
|     [大尺寸食谱图片]               |
|                                  |
+----------------------------------+
|                                  |
|        食谱基本信息                |
|  标题 | 分类 | 地区 | 标签          |
|                                  |
+----------------------------------+
|                                  |
|    配料清单    |    制作步骤        |
|   (左侧区域)   |   (右侧区域)       |
|               |                  |
+----------------------------------+
|                                  |
|        额外信息区域                |
|    YouTube链接 | 来源链接          |
|                                  |
+----------------------------------+
```

### 数据接收和处理

#### 1. URL参数接收
页面通过URL参数接收食谱ID，格式为：`recipe.html?id=52771`

#### 2. 数据获取方式
使用 The MealDB API 的 lookup 接口获取完整食谱数据：
```
https://www.themealdb.com/api/json/v1/1/lookup.php?i=52771
```

#### 3. 数据结构分析
根据 API 返回的数据结构，主要字段包括：

**基本信息字段：**
- `idMeal`: 食谱唯一ID
- `strMeal`: 食谱名称
- `strCategory`: 分类（如：Vegetarian）
- `strArea`: 地区（如：Italian, Moroccan）
- `strMealThumb`: 食谱主图URL
- `strTags`: 标签（逗号分隔，如："Pasta,Curry"）
- `strInstructions`: 制作说明（完整步骤）
- `strYoutube`: YouTube视频链接
- `strSource`: 来源链接

**配料和用量字段：**
- `strIngredient1` 到 `strIngredient20`: 配料名称
- `strMeasure1` 到 `strMeasure20`: 对应配料的用量

### 页面功能模块

#### 1. 导航栏模块
- 显示网站标题 "Recipe-APP"
- 提供返回按钮，点击返回上一页
- 固定在页面顶部，保持导航一致性

#### 2. 食谱主图区域
- 展示食谱的主要图片，尺寸为大图格式
- 图片上叠加显示食谱标题
- 支持图片懒加载，提升页面性能
- 图片加载失败时显示默认占位图

#### 3. 基本信息区域
- 显示食谱分类（Category）：如 Vegetarian、Chicken 等
- 显示菜系地区（Cuisine）：如 Italian、Moroccan 等  
- 显示标签（Tags）：以标签形式展示，如 "Pasta", "Curry"
- 信息以网格布局排列，响应式适配

#### 4. 配料清单模块
- 从API数据中提取 `strIngredient1-20` 和 `strMeasure1-20` 字段
- 过滤空值和无效数据，只显示有效配料
- 以列表形式展示，每行显示：配料名称 + 用量
- 支持配料项的视觉分隔和易读格式

#### 5. 制作步骤模块  
- 将 `strInstructions` 长文本按换行符分割为步骤
- 以有序列表形式展示制作步骤
- 每个步骤独立显示，便于用户跟随操作
- 步骤文本自动去除多余空格和换行

#### 6. 额外信息区域
- YouTube视频链接：如果存在 `strYoutube` 字段则显示
- 原始来源链接：如果存在 `strSource` 字段则显示  
- 链接以新窗口方式打开，不影响当前页面

### 核心功能逻辑

#### 1. 页面初始化流程
- 页面加载时从URL参数获取食谱ID
- 验证ID参数有效性，无效则显示错误提示
- 调用API获取食谱详细数据
- 渲染页面内容或显示加载/错误状态

#### 2. 数据获取和处理
- 使用 The MealDB lookup API 根据ID获取食谱详情
- 处理API响应，验证数据完整性
- 将原始数据转换为页面展示格式
- 处理数据缺失或格式异常情况

#### 3. 内容渲染机制
- 动态填充页面各个区域的内容
- 处理可选字段的条件显示
- 实现标签、配料、步骤的格式化展示
- 设置页面标题和SEO相关信息

### 样式设计要求

#### 1. 响应式布局方案
- 桌面端（≥768px）：配料清单和制作步骤并排显示，充分利用屏幕宽度
- 移动端（<768px）：配料和步骤垂直堆叠，优化触屏操作体验
- 图片区域自适应容器大小，保持宽高比例

#### 2. 视觉设计原则
- 建立清晰的标题层级系统（h1-h3）
- 保持适当的间距和留白，提升阅读体验
- 选择易读的字体大小和行高设置
- 统一的颜色方案和品牌风格

#### 3. 交互体验设计
- 链接和按钮的悬停状态反馈
- 点击操作的视觉确认效果
- 加载过程的状态指示器
- 平滑的过渡动画效果

### 异常处理机制

#### 1. 网络连接问题
- 显示用户友好的网络错误提示信息
- 提供重试按钮，允许用户手动重新加载
- 设置合理的请求超时时间

#### 2. 数据异常处理
- 处理API返回空数据或格式错误的情况
- 为缺失的数据字段提供默认占位内容
- 验证必要字段的存在性

#### 3. 资源加载失败
- 图片加载失败时显示默认食谱占位图
- 实现图片懒加载机制，优化页面性能
- 处理外部链接失效的情况

### 页面功能清单

- [ ] URL参数接收和验证
- [ ] 食谱数据获取和展示
- [ ] 配料清单动态生成
- [ ] 制作步骤格式化展示
- [ ] 标签展示
- [ ] YouTube链接处理
- [ ] 来源链接处理
- [ ] 响应式布局
- [ ] 错误处理和用户反馈
- [ ] 返回按钮功能
- [ ] 图片懒加载
- [ ] SEO优化（页面标题动态设置）

## main.js

### 对于 index.html

当页面加载完成后，通过 `www.themealdb.com/api/json/v1/1/random.php` 生成 Random Recipes 的内容（实现 8 个）。

#### 已完成功能

##### 1. 页面初始化和随机食谱加载
- [x] DOM加载完成后自动初始化应用
- [x] 获取8个随机食谱填充气泡区域
- [x] 并发API请求优化加载速度
- [x] API失败时显示预设热门食谱作为回退方案
- [x] 加载过程中显示"Loading..."状态

##### 2. 搜索功能实现
- [x] 搜索框输入验证（非空、最少2个字符）
- [x] 支持按钮点击和回车键搜索
- [x] 防重复提交机制
- [x] 使用The MealDB搜索API (`search.php?s=query`)
- [x] 搜索结果通过模态框展示

##### 3. 模态框状态管理
- [x] **加载状态**: 显示旋转动画和"Searching Recipes"提示
- [x] **结果状态**: 以网格形式展示搜索结果，显示食谱名称、分类、地区
- [x] **无结果状态**: 友好的"No Results Found"提示和重试按钮
- [x] **错误状态**: 显示具体错误信息和重试功能
- [x] 支持ESC键和点击遮罩关闭模态框

##### 4. 用户交互功能
- [x] 随机食谱气泡点击跳转到recipe.html详情页
- [x] 搜索结果项点击跳转到recipe.html详情页
- [x] 通过URL参数传递食谱ID (`recipe.html?id=mealId`)
- [x] Toast通知系统（成功、警告、错误三种类型）

##### 5. 错误处理和用户体验
- [x] 网络连接失败检测和友好提示
- [x] API响应验证和数据完整性检查
- [x] 全局未处理Promise异常捕获
- [x] 文本截断功能防止界面溢出
- [x] 防抖函数提供（可用于搜索优化）

##### 6. 技术实现细节
- [x] 使用现代ES6+语法（async/await、箭头函数、模板字符串）
- [x] 模块化函数设计，便于维护和测试
- [x] 合理的状态管理和DOM操作
- [x] 响应式设计支持，适配移动端和桌面端
- [x] 符合项目规范（不使用aria标签，正确的命名约定）


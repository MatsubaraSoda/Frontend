# Stopwatch App 开发总结

## 项目概述

基于 HTML/CSS/JavaScript 开发的秒表应用，包含计时功能和圈数记录，集成小猫奔跑动画。

## 技术实现

### 1. CSS 动画 - Sprite Sheet

**实现方式**：使用 CSS `steps()` 函数播放序列帧动画

```css
.cat-run {
    background: url('spritesheet.png') 0 0 no-repeat;
    background-size: 720px 99px;  /* 缩放后的总尺寸 */
    animation: catRun 1.2s steps(6) infinite;
}

@keyframes catRun {
    from { background-position: 0 0; }
    to { background-position: -720px 0; }
}
```

**关键技术点**：
- `steps(6)` 将动画分为6个步骤，对应6帧
- `background-position` 控制显示哪一帧
- 通过 `background-size` 缩放原始图片

### 2. 事件驱动架构

**设计模式**：组件间通过自定义事件通信，避免直接依赖

```javascript
// 全局事件监听器
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('btn.start')) {
        setTimeout(() => {
            document.dispatchEvent(new CustomEvent('stopwatch:start'));
        }, 0);
    }
});

// CatRun 监听事件
class CatRun {
    constructor() {
        document.addEventListener('stopwatch:start', () => this.start());
    }
}
```

**优势**：
- 组件解耦，易于测试
- 可扩展性强，便于添加新功能
- 不修改现有代码结构

### 3. CSS Grid 布局

**表格实现**：使用 CSS Grid 替代传统 table 标签

```css
.laps-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 0;
}

.grid-body {
    display: contents;  /* 关键：让子元素参与父级网格 */
}
```

**HTML 结构**：
```html
<div class="laps-grid">
    <div class="grid-header">
        <div class="grid-cell">圈数</div>
        <div class="grid-cell">圈数时间</div>
        <div class="grid-cell">累计时间</div>
    </div>
    <div class="grid-body" id="lapsGridBody">
        <!-- 动态添加的行 -->
    </div>
</div>
```

### 4. 时间计算与格式化

**核心算法**：
```javascript
formatTime(milliseconds) {
    const totalSeconds = Math.floor(milliseconds / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    const centiseconds = Math.floor((milliseconds % 1000) / 10);
    
    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}:${centiseconds.toString().padStart(2, '0')}`;
}
```

**圈数时间计算**：
```javascript
const lapTime = currentTime - this.lastLapTime;
```

### 5. 资源管理

**定时器清理**：
```javascript
destroy() {
    if (this.timerInterval) {
        clearInterval(this.timerInterval);
        this.timerInterval = null;
    }
}

// 页面卸载时清理
window.addEventListener('beforeunload', () => {
    if (stopwatchInstance) {
        stopwatchInstance.destroy();
    }
});
```

## 文件结构

```
Stopwatch-App/
├── index.html          # 主页面
├── main.js            # 主要逻辑
├── style.css          # 样式文件
├── demo.html          # 动画测试页面
└── docs/              # 文档目录
    ├── Stopwatch-App.md
    ├── Stopwatch-App-中文版.md
    ├── 序列帧.md
    └── 开发总结.md
```

## 开发要点

### 1. 动画控制
- 使用 CSS 类切换控制动画状态
- `animation: none` 停止动画
- `animation-play-state: paused` 暂停动画

### 2. 状态管理
- `isRunning` 统一管理计时状态
- 圈数记录通过数组存储
- DOM 元素缓存避免重复查询

### 3. 用户体验
- 响应式设计支持多设备
- 简洁的视觉风格
- 实时反馈和状态同步

### 4. 代码组织
- 面向对象设计，职责分离
- 事件驱动架构，松耦合
- 模块化思维，易于维护

## 技术栈

- **HTML5**：语义化标签
- **CSS3**：Grid 布局、动画、伪元素
- **JavaScript ES6+**：类、箭头函数、模板字符串
- **Web APIs**：CustomEvent、setInterval、DOM 操作

## 总结

项目采用现代前端技术栈，通过合理的架构设计实现了功能完整、代码清晰的秒表应用。重点在于动画实现、事件驱动架构和响应式布局的技术应用。

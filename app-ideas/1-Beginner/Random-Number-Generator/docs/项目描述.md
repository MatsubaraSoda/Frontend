# 项目描述

- 项目名：Random-Number-Generator
- class 采用烤肉式命名，id 采用驼峰式命名
- 本地项目自己的 js 采用 ES Module 导入方法。

原本计划按照 `Random-Number-Generator-中文版.md` 内容实现这个 Web 应用。但是这种 Web 应用随便上网搜索能找到同质应用一大片。

因此，项目开发将采用这个文档的内容进行。

## 蒙特卡洛模拟

假设有一个非常特殊的骰子，用户输入一个最小数字和一个最大数字。这两个数字决定了这个骰子能够投掷出来的数字（步长为1）。

### 输入验证规则
- 最小值和最大值必须是整数
- 最小值必须小于最大值（不能相等）
- 取值范围：[0, 100]
- 如果输入不符合要求，显示错误提示并阻止模拟开始

这个 Web 应用将投掷这个骰子（1000次/5000次/10000次）。统计所有投掷结果的平均值。

对于第 n 次投掷，当前的平均值为（f(i) 代表第 i 次投掷的结果）
$$
\frac{\Sigma_1^n f(i)}{n}
$$
对于投掷总次数为 m （1000/5000/10000）次，统计结果为 $(i,\frac{\Sigma_1^i f(i)}{i})$ 。对统计结果绘制折线图表示。

根据概率论的知识，平均值的期望为 $(\Sigma_{i=min}^{max} i )/ (max-min+1)$。

如此，我们有个三幅折线图。分别对应 1000/5000/10000 次投掷后的平均值。

使用前端的 `<canvas>` 标签绘制它们。

绘制要求：

- $(i,\frac{\Sigma_1^i f(i)}{i})$ 的折线图
- 显示 $y=(\Sigma_{i=min}^{max} i )/ (max-min+1)$ 水平线
- 三幅图均为正方形。

## index.html

- 文本
  - 应用名字
  - 引导用户填写一个最小值和最大值
  - 这个项目的简单介绍
- 交互
  - 两个input，分别代表最小值和最大值
  - 一个开始模拟按钮
- 显示
  - 响应式设计：
    - 大屏幕（≥ 1200px）：一行显示三个折线图
    - 中等屏幕（768px - 1199px）：第一行两个，第二行一个
    - 小屏幕（< 768px）：共三行，一行一个
  - 加载状态：模拟进行时显示加载动画
  - 错误提示：API 调用失败时显示"生成随机数失败，请重试。"
  - 一个"结语"，告诉用户平均值的数学期望是多少，对应投掷次数的结果的真实平均值是多少，和数学期望偏差了多少。

```
平均值的数学期望为：
投掷 1000 次骰子的平均值为：；与数学期望偏差了：%。
投掷 5000 次骰子的平均值为：；与数学期望偏差了：%。
投掷 10000 次骰子的平均值为：；与数学期望偏差了：%。
```

## style.css

全权交由 AI 生成。风格要求如下：

- 不使用彩色
- 简约、干净、清爽
- 白色为主色
- 无圆角设计（按钮、表格等），即有棱有角的感觉
- 响应式（尤其是这三个图表的布局）

## main.js

### 随机数生成

写在 `random.js`里面。random.js 从 main.js 接受两个值：theMinValue 和 theMaxValue。生成三组 $(i,\frac{\Sigma_1^i f(i)}{i})$。m 分别为 1000，5000，10000.将数据传给 `plot.js`

#### 数据格式定义
```javascript
// random.js 返回的数据格式
{
  success: boolean,
  data: {
    simulation1000: [
      {iteration: 1, value: 5, average: 5.0},
      {iteration: 2, value: 7, average: 6.0},
      // ... 更多数据点
    ],
    simulation5000: [
      {iteration: 1, value: 6, average: 6.0},
      {iteration: 2, value: 4, average: 5.0},
      // ... 更多数据点
    ],
    simulation10000: [
      {iteration: 1, value: 5, average: 5.0},
      {iteration: 2, value: 8, average: 6.5},
      // ... 更多数据点
    ]
  },
  theoreticalAverage: number,
  seed: string,
  error?: string
}
```

考虑到 RANDOM.ORG 有限额，但是又希望随机性有一定的保证，所以采用一个折衷方案。

使用 API：

```
https://www.random.org/cgi-bin/randbyte?nbytes=16&format=h
```

返回内容（参考）：

```
7c f8 d2 b6 07 dc b1 5d 27 1f 3f 26 9a e9 17 33 

```

种子随机数使用 `npm install seedrandom`（已安装）。

结合 `混合随机数生成方案.md`内容实现。

#### 错误处理
- 如果 RANDOM.ORG API 调用失败，返回错误信息
- 不使用时间戳等备选方案
- 前端显示"生成随机数失败，请重试。"提示
- 用户可以选择重试

### 折线图

使用`npm i chart.js`（已安装）。

写在 `plot.js` 里面。

将从 random.js 收到三组数据，绘制折线图。

#### 图表要求
- 使用 Chart.js 库绘制
- 每个图表显示对应次数的模拟结果
- 折线图显示平均值随投掷次数的变化
- 添加理论期望值的水平参考线
- 图表为正方形，响应式布局
- 图表标题：投掷 X 次骰子的平均值变化
- X 轴：投掷次数
- Y 轴：平均值

#### 图表配置
```javascript
// 图表基本配置
{
  type: 'line',
  data: {
    datasets: [
      {
        label: '实际平均值',
        data: simulationData,
        borderColor: '#000000',
        backgroundColor: 'transparent'
      },
      {
        label: '理论期望值',
        data: theoreticalLine,
        borderColor: '#666666',
        borderDash: [5, 5],
        pointRadius: 0
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: true,
    aspectRatio: 1,
    scales: {
      x: { title: { display: true, text: '投掷次数' } },
      y: { title: { display: true, text: '平均值' } }
    }
  }
}
```

## 项目结构

```
Random-Number-Generator/
├── index.html          # 主页面
├── style.css           # 样式文件
├── main.js             # 主逻辑文件
├── random.js           # 随机数生成模块
├── plot.js             # 图表绘制模块
├── package.json        # 项目配置
└── docs/               # 文档目录
    ├── 项目描述.md
    ├── Random-Number-Generator.md
    ├── Random-Number-Generator-中文版.md
    ├── RANDOM.ORG.md
    └── 混合随机数生成方案.md
```

## 实现流程

1. **用户输入验证**：检查最小值和最大值的有效性
2. **获取随机种子**：调用 RANDOM.ORG API 获取随机字节
3. **初始化随机数生成器**：使用 seedrandom 库和获取的种子
4. **执行蒙特卡洛模拟**：分别进行 1000、5000、10000 次投掷
5. **数据处理**：计算每次投掷后的平均值
6. **绘制图表**：使用 Chart.js 绘制三个折线图
7. **显示结果**：展示理论期望值、实际平均值和偏差

## 技术要点

- **ES Module**：使用 `import/export` 语法
- **异步处理**：API 调用和模拟过程都是异步的
- **错误处理**：完善的错误提示和重试机制
- **响应式设计**：适配不同屏幕尺寸
- **无彩色设计**：简约的黑白灰配色方案

## TODO-LIST

### 阶段一：项目基础搭建

- [ ] **1.1 创建项目文件结构**
  - 创建 `index.html`、`style.css`、`main.js`、`random.js`、`plot.js`
  - 确认 `package.json` 和依赖已正确安装

- [ ] **1.2 生成基础 HTML 结构**
  - 创建页面标题、输入区域、按钮、结果显示区域
  - 使用精炼的 class（烤肉式）和 id（驼峰式）命名
  - 添加三个 `<canvas>` 容器用于图表显示

- [ ] **1.3 创建临时开发样式**
  - 编写简单的 CSS 用于开发阶段
  - 确保基本布局可见，便于开发调试
  - 注意：此样式将在后期重写

### 阶段二：模块导入关系验证

- [ ] **2.1 初始化 ES Module 导入**
  - 在 `main.js` 中导入 `random.js` 和 `plot.js`
  - 在 `random.js` 中导入 `seedrandom` 库
  - 在 `plot.js` 中导入 `chart.js` 库
  - 验证所有导入关系正常工作

- [ ] **2.2 基础函数框架**
  - 在 `main.js` 中创建基础事件处理函数
  - 在 `random.js` 中创建数据生成函数框架
  - 在 `plot.js` 中创建图表绘制函数框架

### 阶段三：核心功能开发

- [ ] **3.1 用户输入验证**
  - 实现输入框验证（整数、范围、大小关系）
  - 添加实时验证反馈
  - 实现按钮状态管理（禁用/启用）

- [ ] **3.2 随机数生成功能**
  - 实现 RANDOM.ORG API 调用
  - 集成 `seedrandom` 库
  - 生成三组模拟数据（1000/5000/10000次）
  - 在控制台输出数据供验证

- [ ] **3.3 数据计算和统计**
  - 计算每次投掷后的平均值
  - 计算理论期望值
  - 计算偏差百分比
  - 准备结果展示数据

### 阶段四：图表绘制功能

- [ ] **4.1 Chart.js 集成**
  - 配置三个折线图
  - 实现响应式图表布局
  - 添加理论期望值参考线

- [ ] **4.2 图表数据绑定**
  - 将模拟数据绑定到图表
  - 设置图表标题和坐标轴标签
  - 确保图表正确显示

### 阶段五：用户界面完善

- [ ] **5.1 加载状态管理**
  - 添加模拟过程中的加载动画
  - 实现按钮状态切换
  - 添加进度提示

- [ ] **5.2 错误处理**
  - 实现 API 调用失败处理
  - 添加用户友好的错误提示
  - 实现重试功能

- [ ] **5.3 结果显示**
  - 显示理论期望值和实际平均值
  - 显示偏差百分比
  - 格式化结果输出

### 阶段六：样式和布局优化

- [ ] **6.1 响应式布局实现**
  - 实现大屏幕（≥1200px）布局
  - 实现中等屏幕（768px-1199px）布局
  - 实现小屏幕（<768px）布局

- [ ] **6.2 最终样式重写**
  - 删除临时开发样式
  - 按照项目要求重新设计（无彩色、简约、清爽）
  - 实现无圆角设计风格

### 阶段七：测试和验证

- [ ] **7.1 功能测试**
  - 测试正常输入场景
  - 测试边界值（min=0, max=100）
  - 测试无效输入处理

- [ ] **7.2 错误场景测试**
  - 测试网络连接失败
  - 测试 API 调用失败
  - 测试用户输入错误

- [ ] **7.3 数据验证**
  - 验证随机数范围正确性
  - 验证平均值计算准确性
  - 验证偏差计算正确性

### 阶段八：最终优化

- [ ] **8.1 性能优化**
  - 优化大量数据生成性能
  - 优化图表渲染性能
  - 添加必要的缓存机制

- [ ] **8.2 用户体验优化**
  - 优化加载时间
  - 改进错误提示
  - 完善交互反馈

- [ ] **8.3 最终集成测试**
  - 完整用户流程测试
  - 跨浏览器兼容性测试
  - 移动端适配测试
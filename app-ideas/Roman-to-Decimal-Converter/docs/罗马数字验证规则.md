# 罗马数字验证规则

本文档详细说明了罗马数字字符串的验证规则，用于确保输入的罗马数字符合正确的语法和语义规则。

## 基本要求

### 1. 数据类型验证
- **必须是字符串类型**：输入必须是 `string` 类型，不能是数字、布尔值、对象等
- **非空字符串**：不能是空字符串 `""`
- **字符编码**：必须使用正确的Unicode编码（特别是带横线的符号）

### 2. 字符有效性验证
- **只能包含 `romanMap` 中的字符**：
  - 基础符号：`I`, `V`, `X`, `L`, `C`, `D`, `M`
  - 单横线符号：`V̅`, `X̅`, `L̅`, `C̅`, `D̅`, `M̅`
  - 双横线符号：`V̅̅`, `X̅̅`, `L̅̅`, `C̅̅`, `D̅̅`, `M̅̅`
- **不能包含其他字符**：空格、标点符号、英文字母、数字等都不允许
- **Unicode编码正确性**：确保带横线的符号使用正确的Unicode编码

## 罗马数字组别概念

根据《罗马数字模式文档》，罗马数字符号按照功能分为三个组别：

### a组（最小符号）
- **功能**：表示 1, 2, 3 以及减法中的 9
- **符号**：`I`, `X`, `C`, `M`, `X̅`, `C̅`, `M̅`, `X̅̅`, `C̅̅`, `M̅̅`
- **重复规则**：最多可以连续出现 **3次**

### b组（中间符号）
- **功能**：表示 5, 6, 7, 8
- **符号**：`V`, `L`, `D`, `V̅`, `L̅`, `D̅`, `V̅̅`, `L̅̅`, `D̅̅`
- **重复规则**：**不能自我重复**

### c组（下一组的最小符号）
- **功能**：减法中的 4 和 9，以及作为更高位的a组
- **符号**：`X`, `C`, `M`, `X̅`, `C̅`, `M̅`, `X̅̅`, `C̅̅`, `M̅̅`
- **重复规则**：最多可以连续出现 **3次**

## 重复次数限制规则

### 1. a组符号重复限制
- **允许重复**：`I`, `X`, `C`, `M`, `X̅`, `C̅`, `M̅`, `X̅̅`, `C̅̅`, `M̅̅`
- **重复次数**：最多连续出现 **3次**
- **有效示例**：`I`, `II`, `III`, `XXX`, `CCC`, `MMM`
- **无效示例**：`IIII`, `XXXX`, `CCCC`, `MMMM`

### 2. b组符号重复限制
- **禁止重复**：`V`, `L`, `D`, `V̅`, `L̅`, `D̅`, `V̅̅`, `L̅̅`, `D̅̅`
- **重复次数**：**绝对不能重复**
- **有效示例**：`V`, `L`, `D`
- **无效示例**：`VV`, `LL`, `DD`, `VVV`, `LLL`, `DDD`

## 减法规则

### 1. 减法符号限制
- **只有c组成员可用于减法**：`X`, `C`, `M`, `X̅`, `C̅`, `M̅`, `X̅̅`, `C̅̅`, `M̅̅`
- **b组成员永远不能用于减法**：`V`, `L`, `D`, `V̅`, `L̅`, `D̅`, `V̅̅`, `L̅̅`, `D̅̅`

### 2. 减法对象限制
- **一个符号只能从比他大一个或两个数量级的符号中减去**
- **具体规则**：
  - `I` 只能从 `V` 和 `X` 中减去
  - `X` 只能从 `L` 和 `C` 中减去  
  - `C` 只能从 `D` 和 `M` 中减去
  - `X̅` 只能从 `L̅` 和 `C̅` 中减去
  - `C̅` 只能从 `D̅` 和 `M̅` 中减去
  - `X̅̅` 只能从 `L̅̅` 和 `C̅̅` 中减去
  - `C̅̅` 只能从 `D̅̅` 和 `M̅̅` 中减去

### 3. 减法唯一性
- **一个符号只能用于一次减法**
- **有效示例**：`IV`, `IX`, `XL`, `XC`, `CD`, `CM`
- **无效示例**：`IIX`, `IIV`, `XXL`, `XXC`, `CCD`, `CCM`

### 4. 减法组合连续性
- **减法组合必须是连续的，不能有间隔**
- **有效示例**：`IV`, `IX`, `XL`, `XC`, `CD`, `CM`
- **无效示例**：`IXX`, `IXL`, `CXX`, `CXL`（减法后不能立即跟其他符号）

## 从左到右排序规则

### 1. 基本排序原则
- **整体顺序**：除了减法规则外，罗马数字应该从大到小排列
- **正常顺序**：`M` > `D` > `C` > `L` > `X` > `V` > `I`

### 2. 减法排序规则
- **如果较小的符号出现在较大的符号前面，必须符合减法规则**
- **有效示例**：
  - `XIX`：合法，因为 `I` 在 `X` 前符合减法规则
  - `IV`：合法，`I` 在 `V` 前符合减法规则
  - `CM`：合法，`C` 在 `M` 前符合减法规则
- **无效示例**：
  - `IL`：无效，`I` 不能从 `L` 中减去
  - `IC`：无效，`I` 不能从 `C` 中减去
  - `XD`：无效，`X` 不能从 `D` 中减去

## 长度和范围限制

### 1. 最大长度限制
- **理论最大长度**：基于范围1-999,999,999
- **最长罗马数字**：`C̅̅M̅̅X̅̅C̅̅M̅X̅̅C̅M̅X̅C̅MX̅CMXCIX`（约34个字符）
- **实际限制**：字符串长度不应超过50个字符（包含安全边界）

### 2. 最小长度限制
- **最小长度**：1个字符（如 `I`, `V`, `X` 等）
- **不能为空字符串**

## 验证示例

### 有效罗马数字
```
I, II, III, IV, V, VI, VII, VIII, IX
X, XX, XXX, XL, L, LX, LXX, LXXX, XC
C, CC, CCC, CD, D, DC, DCC, DCCC, CM
M, MM, MMM, MV̅, V̅, V̅M, V̅MM, V̅MMM, MX̅
XIX, XLIX, XCIV, MMMCMXCIX
```

### 无效罗马数字
```
""           // 空字符串
" "          // 包含空格
"ABC"        // 包含无效字符
"123"        // 包含数字
"IIII"       // I重复超过3次
"VV"         // V重复（b组符号不能重复）
"LL"         // L重复（b组符号不能重复）
"DD"         // D重复（b组符号不能重复）
"IIX"        // 无效减法组合
"IL"         // I不能从L中减去
"IC"         // I不能从C中减去
"XD"         // X不能从D中减去
"VX"         // V不能用于减法
"LC"         // L不能用于减法
"DM"         // D不能用于减法
"IXX"        // 减法后不能立即跟其他符号
"IXL"        // 减法组合不连续
"CXX"        // 减法后不能立即跟其他符号
"CXL"        // 减法组合不连续
```

## 实现建议

### 1. 验证步骤
1. **数据类型检查**：确保输入是字符串
2. **长度检查**：验证字符串长度在合理范围内
3. **字符有效性检查**：使用正则表达式验证字符
4. **重复规则检查**：验证a组和b组的重复限制
5. **减法规则检查**：验证减法组合的有效性
6. **减法连续性检查**：确保减法组合是连续的
7. **排序规则检查**：验证整体排序的正确性

### 2. 性能考虑
- **正则表达式优先**：使用预编译的正则表达式进行字符匹配
- **早期返回**：在发现无效情况时立即返回false
- **缓存验证结果**：对于相同的输入可以缓存验证结果

## 总结

罗马数字验证需要综合考虑字符有效性、重复限制、减法规则和排序规则等多个方面。通过系统化的验证规则，可以确保输入的罗马数字字符串符合正确的语法和语义要求。

这些规则不仅适用于基础的罗马数字，也适用于带横线的扩展罗马数字符号，为处理大数字（最大999,999,999）提供了完整的验证框架。
